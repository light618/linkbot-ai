# 🚀 Railway 部署快速指南

## 一、部署三个服务

### 1. Go 代理服务（渠道监听）

**仓库：** `light618/linkbot-ai`  
**根目录：** `/`（根目录）

**环境变量：**
```bash
DOUYIN_APP_ID=你的抖音AppID
DOUYIN_APP_SECRET=你的抖音AppSecret
REDIRECT_URI=https://你的go服务地址.railway.app/oauth/callback
COZE_API=https://api.coze.com/open/v1
COZE_TOKEN=你的Coze Token
```

**重要：** 部署后，Railway 会分配一个地址，格式如：`https://linkbot-ai-go.up.railway.app`

### 2. Node.js 后端 API

**仓库：** `light618/linkbot-ai`  
**根目录：** `/backend`

**环境变量：**
```bash
API_PORT=3001
CORS_ORIGIN=https://你的前端地址.railway.app
GO_SERVICE_URL=https://你的go服务地址.railway.app
# 数据库和Redis配置...
```

### 3. React 前端

**仓库：** `light618/linkbot-ai-frontend`  
**根目录：** `/`（根目录）

**环境变量：**
```bash
REACT_APP_API_URL=https://你的后端API地址.railway.app
REACT_APP_WS_URL=wss://你的go服务地址.railway.app
```

## 二、配置抖音回调地址

### 步骤：

1. **获取 Go 服务的公网地址**
   - 部署完成后，在 Railway 控制台查看 Go 服务的地址
   - 格式：`https://xxx.up.railway.app`

2. **登录抖音开放平台**
   - 访问：https://open.douyin.com/
   - 进入你的应用管理页面

3. **配置回调地址**
   - 找到 **"授权回调地址"** 或 **"Redirect URI"** 配置
   - 填写：`https://你的go服务地址.railway.app/oauth/callback`
   - **注意：** 必须与 Go 服务的 `REDIRECT_URI` 环境变量完全一致

4. **更新 Go 服务环境变量**
   - 在 Railway 中更新 `REDIRECT_URI` 环境变量
   - 确保与抖音后台配置的地址完全一致

## 三、验证部署

1. 访问前端：`https://你的前端地址.railway.app`
2. 登录系统
3. 进入"渠道管理" → "抖音"
4. 点击"授权登录"
5. 应该能正常跳转到抖音授权页面
6. 授权成功后应该能正确回调

## 四、常见问题

### ❌ 回调地址不匹配
**解决：** 确保抖音后台和 `REDIRECT_URI` 环境变量完全一致（包括协议、域名、路径）

### ❌ CORS 错误
**解决：** 检查后端 API 的 `CORS_ORIGIN` 环境变量，确保包含前端地址

### ❌ 服务无法启动
**解决：** Railway 会自动设置 `PORT`，确保代码使用 `process.env.PORT`

## 五、部署检查清单

- [ ] Go 服务已部署并运行
- [ ] Node.js 后端已部署并运行  
- [ ] React 前端已部署并运行
- [ ] 所有环境变量已配置
- [ ] 抖音回调地址已在抖音后台配置
- [ ] `REDIRECT_URI` 与抖音后台一致
- [ ] 前端可以访问后端 API
- [ ] 授权流程可以正常完成

